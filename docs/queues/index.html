<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Named Queues · tinyCI</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Named Queues are a scoping &amp;amp; routing mechanism for CI runs. Each run can be&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Named Queues · tinyCI"/><meta property="og:type" content="website"/><meta property="og:url" content="https://tinyci.org/"/><meta property="og:description" content="&lt;p&gt;Named Queues are a scoping &amp;amp; routing mechanism for CI runs. Each run can be&lt;/p&gt;
"/><meta property="og:image" content="https://tinyci.org/img/logo-mains.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://tinyci.org/img/logo-main.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/zenburn.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-139424969-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-reverse-title.png" alt="tinyCI"/><h2 class="headerTitleWithLogo">tinyCI</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro" target="_self">Intro</a></li><li class=""><a href="/docs/configuration" target="_self">Configuration Guide</a></li><li class=""><a href="/docs/api" target="_self">API</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Overview</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Set up tinyCI</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/intro">Intro</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/terminology">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/overview">Services Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/clients">TinyCI Clients</a></li><li class="navListItem"><a class="navItem" href="/docs/runner">CI Runners</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/queues">Named Queues</a></li><li class="navListItem"><a class="navItem" href="/docs/diff_selection">Diff Selection</a></li><li class="navListItem"><a class="navItem" href="/docs/capabilities">User Capabilities</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Named Queues</h1></header><article><div><span><p>Named Queues are a scoping &amp; routing mechanism for CI runs. Each run can be
assigned to <em>write to</em> an independent queue as well as each runner can be
assigned to <em>read from</em> a queue. The queue names are arbitrary and are intended
to reflect your needs from a visibility standpoint as to what you are running
the run on.</p>
<p>This mechanism allows you to direct runs to resources based on the name of the
submitter and listener lining up.</p>
<p>Here's a small example of a <code>task.yml</code> that has runs that use different queues.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">mountpoint:</span> <span class="hljs-string">'/foo'</span>
<span class="hljs-attr">runs:</span>
<span class="hljs-attr">  queueOne:</span>
<span class="hljs-attr">    command:</span> <span class="hljs-string">['cat',</span> <span class="hljs-string">'/proc/cpuinfo'</span><span class="hljs-string">]</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">'foo'</span>
<span class="hljs-attr">    queue:</span> <span class="hljs-string">'one'</span>
<span class="hljs-attr">  queueTwo:</span>
<span class="hljs-attr">    command:</span> <span class="hljs-string">['cat',</span> <span class="hljs-string">'/proc/cpuinfo'</span><span class="hljs-string">]</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">'foo'</span>
<span class="hljs-attr">    queue:</span> <span class="hljs-string">'two'</span>
<span class="hljs-attr">  queueThree:</span>
<span class="hljs-attr">    command:</span> <span class="hljs-string">['cat',</span> <span class="hljs-string">'/proc/cpuinfo'</span><span class="hljs-string">]</span>
<span class="hljs-attr">    image:</span> <span class="hljs-string">'foo'</span>
<span class="hljs-attr">    queue:</span> <span class="hljs-string">'three'</span>
</code></pre>
<p>Finally, let's presume that each one of the queues has at least one runner
listening on each of the queue names. You can see how these are configured in
the overlay runner <a href="/docs/runner#configuring-it">here</a>.</p>
<p>In effect, we're listing the CPU properties of each VM or environment that the
queue is listening on. Assuming the command is executed and the image is
constant, the only thing that really differs here is <em>how the run is launched</em>,
which is determined by the runner listening on the queue.</p>
<p>So, if one is an x86 Intel, another a Ryzen chip, and a third an ARM, these
will all yield independent logs (and in parallel assuming they're not busy
already) about the processor architectures the runner occupied.</p>
<p>Careful use of named queues can result in many successes in hybrid repositories
or CI environments in general, where resources may be different for the ideal
test case. This way it's not necessary to have to leave a 128GB metal server
lying around to deal with your database throughput tests and end up having it run
simpler things like linters all day. Other repositories can also use these same
resources if they are tied to the same CI system transparently, allowing for
more hybrid utilization between teams.</p>
<p>Because of the exploitative properties of using named queues in public
environments, we have adopted a number of overrides and constraints the set in
the <code>tinyci.yml</code> file which is read differently from other files. You can read
more about it in our <a href="/docs/repository_properties#tinyciyml-global-configuration">configuration guide</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/runner"><span class="arrow-prev">← </span><span>CI Runners</span></a><a class="docs-next button" href="/docs/diff_selection"><span>Diff Selection</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo-reverse.png" alt="tinyCI" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/intro.html">Getting Started</a><a href="/docs/en/installation.html">Installation Guide</a><a href="/docs/en/configuration.html">Configuration Guide</a><a href="/docs/en/api.html">API Reference</a></div><div><h5>Community</h5><a target="_blank" href="https://discord.gg/Y5tpxhU">Project Chat</a><a href="https://twitter.com/tinyci2" target="_blank" rel="noreferrer noopener">tinyCI Twitter</a></div><div><h5>More</h5><a class="github-button" href="https://github.com/tinyci/tinyci" data-icon="octicon-star" data-count-href="https://github.com/tinyci/tinyci/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star us on Github</a></div></section><section class="copyright">Copyright © 2019 Erik Hollensbe</section></footer></div></body></html>